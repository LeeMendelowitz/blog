<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Lee On Coding</title><link href="https://leemendelowitz.github.io/blog/" rel="alternate"></link><link href="https://leemendelowitz.github.io/blog/feeds/c.atom.xml" rel="self"></link><id>https://leemendelowitz.github.io/blog/</id><updated>2014-12-23T22:02:00+01:00</updated><entry><title>std::sort and std::bad_alloc</title><link href="https://leemendelowitz.github.io/blog/sort-bad-alloc.html" rel="alternate"></link><published>2014-12-23T22:02:00+01:00</published><author><name>Lee Mendelowitz</name></author><id>tag:leemendelowitz.github.io,2014-12-23:blog/sort-bad-alloc.html</id><summary type="html">&lt;p&gt;Sometimes programming in C++ is wonderful when everything works and programs run blazingly fast, and then there are those painful moments when you encounter hard to diagnose runtime errors.&lt;/p&gt;
&lt;p&gt;In this case, I was calling &lt;code&gt;std::sort&lt;/code&gt; to sort a &lt;code&gt;std::vector&lt;/code&gt; of &lt;code&gt;Alignment&lt;/code&gt; objects.
I was using my own custom compare class to determine when one &lt;code&gt;Alignment&lt;/code&gt; object should appear before the other.&lt;/p&gt;
&lt;p&gt;The sort failed by throwing a &lt;code&gt;std::bad_alloc&lt;/code&gt; exception, which is &lt;a href="http://www.cplusplus.com/reference/new/bad_alloc/"&gt;thrown when failing to allocate memory&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I was baffled for quite a while and had to step into the &lt;code&gt;gdb&lt;/code&gt; debugger to get a very long backtrace with all of the gory details.&lt;/p&gt;
&lt;p&gt;After quite some time, it boiled down to the fact that I had a bug in the &lt;code&gt;Alignment&lt;/code&gt;assignment operator: &lt;code&gt;Alignment&amp;amp; operator=(const Alignment&amp;amp; a)&lt;/code&gt;. This buggy assignment operator did not properly assign all of the attributes of the &lt;code&gt;Alignment&lt;/code&gt; object - in particular it failed to properly assign the attribute being sorted on (oops!) - and this had the effect of violating the strict weak ordering which &lt;code&gt;std::sort&lt;/code&gt; requires of the compare operator. This, in turn, somehow resulted in the &lt;code&gt;std::bad_alloc&lt;/code&gt; exception. &lt;/p&gt;
&lt;p&gt;It turns out I did not even need to provide a custom assignment operator - the default provided by the compiler would do.&lt;/p&gt;
&lt;p&gt;For future reference, here's a &lt;a href="http://stackoverflow.com/questions/9170080/stdsort-getting-a-stdbad-alloc"&gt;Stack Overflow&lt;/a&gt; post where someone else encountered the same thing.&lt;/p&gt;
&lt;p&gt;Like I said, C++ can be painful.&lt;/p&gt;</summary><category term="C++"></category></entry></feed>